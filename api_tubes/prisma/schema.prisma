generator client {
  // provider = "prisma-client"
  provider = "prisma-client-js"
  output   = "../generated/prisma"
  // previewFeatures = ["typedSql"]
  // engineType = "client"
}

datasource db {
  provider = "postgresql"
  // eslint-disable-next-line
  url      = env("DATABASE_URL")
}

// Сотрудники
model Employee {
  id                 Int                @id @default(autoincrement())
  name               String
  barcode            String             @unique @db.VarChar(13)
  rank               Rank?              @relation(fields: [rank_id], references: [id])
  rank_id            Int
  banned             Boolean            @default(false)
  consumed_materials ConsumedMaterial[]
  extrusion_params   ExtrusionParam[]
  varnish_params     VarnishParam[]
  offset_params      OffsetParam[]
  sealant_params     SealantParam[]
  extrusion_statuses ExtrusionStatus[]
  varnish_statuses   VarnishStatus[]
  offset_statuses    OffsetStatus[]
  sealant_statuses   SealantStatus[]
  production_boxes   ProductionBox[]

  @@map("employees")
}

model Rank {
  id          Int        @id @default(autoincrement())
  val         Int
  description String
  employees   Employee[]

  @@map("ranks")
}

//  Продукция
model Product {
  id                  Int                 @id @default(autoincrement())
  code                String              @unique
  marking             String
  name                String
  summaries           Summary[]
  extrusion_tresholds ExtrusionTreshold[]
  varnish_tresholds   VarnishTreshold[]
  offset_tresholds    OffsetTreshold[]
  sealant_tresholds   SealantTreshold[]
  pictures            Pictures[]

  @@map("products")
}

model Pictures {
  id         Int     @id @default(autoincrement())
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id Int
  src        String

  @@map("pictures")
}

model ExtrusionSopPictures {
  id           Int                @id @default(autoincrement())
  operation    ExtrusionOperation @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id Int
  src          String

  @@map("extrusion_sop_pictures")
}

model VarnishSopPictures {
  id           Int              @id @default(autoincrement())
  operation    VarnishOperation @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id Int
  src          String

  @@map("varnish_sop_pictures")
}

model OffsetSopPictures {
  id           Int             @id @default(autoincrement())
  operation    OffsetOperation @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id Int
  src          String

  @@map("offset_sop_pictures")
}

model SealantSopPictures {
  id           Int              @id @default(autoincrement())
  operation    SealantOperation @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id Int
  src          String

  @@map("sealant_sop_pictures")
}

// Конвейеры
model Conveyor {
  id                 Int                 @id @default(autoincrement())
  name               String              @unique
  summaries          Summary[]
  printers           Printer[]
  extrusionTresholds ExtrusionTreshold[]
  varnishTresholds   VarnishTreshold[]
  offsetTresholds    OffsetTreshold[]
  sealantTresholds   SealantTreshold[]

  @@map("conveyors")
}

model Batch {
  id               Int             @id @default(autoincrement())
  name             String          @unique
  summaries        Summary[]
  production_boxes ProductionBox[]

  @@map("batches")
}

model ProductionBox {
  id          Int      @id @default(autoincrement())
  uuid        String   @unique
  box_number  Int
  summary     Summary  @relation(fields: [summary_id], references: [id], onUpdate: Cascade)
  summary_id  Int
  batch       Batch    @relation(fields: [batch_id], references: [id], onUpdate: Cascade)
  batch_id    Int
  employee    Employee @relation(fields: [employee_id], references: [id], onUpdate: Cascade)
  employee_id Int
  quantity    Int
  createdAt   DateTime @default(now())

  @@map("production_boxes")
}

model Printer {
  id          Int      @id @default(autoincrement())
  conveyor    Conveyor @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id Int      @unique
  ip          String
  port        Int

  @@map("printers")
}

//  Рондоль
model Rondel {
  id                  Int                 @id @default(autoincrement())
  value               String
  extrusion_params    ExtrusionParam[]
  extrusion_tresholds ExtrusionTreshold[]

  @@map("rondels")
}

// Партии материалов
model Lot {
  id                 Int                @id @default(autoincrement())
  material           Material           @relation(fields: [material_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  material_id        Int
  value              String
  consumed_materials ConsumedMaterial[]

  @@unique(name: "material_lot", [value, material_id])
  @@map("lots")
}

// Запись сводки
model Summary {
  id                 Int                @id @default(autoincrement())
  product            Product            @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id         Int
  batch              Batch              @relation(fields: [batch_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  batch_id           Int
  conveyor           Conveyor           @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id        Int
  plan               Int
  isActive           Boolean            @default(false)
  isFinished         Boolean            @default(false)
  date               DateTime
  shift              Int                @default(1)
  specifications     Specification[]
  consumed_materials ConsumedMaterial[]
  notes              Note[]
  extrusion_params   ExtrusionParam[]
  varnish_params     VarnishParam[]
  offset_params      OffsetParam[]
  sealant_params     SealantParam[]
  extrusion_statuses ExtrusionStatus[]
  varnish_statuses   VarnishStatus[]
  offset_statuses    OffsetStatus[]
  sealant_statuses   SealantStatus[]
  production_boxes   ProductionBox[]
  extrusion_defects  ExtrusionDefect[]
  varnish_defects    VarnishDefect[]
  offset_defects     OffsetDefect[]
  selant_defects     SealantDefect[]

  @@map("summaries")
}

model ExtrusionDefect {
  id         Int     @id @default(autoincrement())
  summary    Summary @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id Int     @unique
  value      Float

  @@map("extrusion_defects")
}

model VarnishDefect {
  id         Int     @id @default(autoincrement())
  summary    Summary @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id Int     @unique
  value      Float

  @@map("varnish_defects")
}

model OffsetDefect {
  id         Int     @id @default(autoincrement())
  summary    Summary @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id Int     @unique
  value      Float

  @@map("offset_defects")
}

model SealantDefect {
  id         Int     @id @default(autoincrement())
  summary    Summary @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id Int     @unique
  value      Float

  @@map("sealant_defects")
}

// Комплектующие
model Material {
  id                 Int                @id @default(autoincrement())
  code               String             @unique
  name               String
  post_number        Int
  specifications     Specification[]
  consumed_materials ConsumedMaterial[]
  lots               Lot[]

  @@map("materials")
}

//Спецификации
model Specification {
  id          Int      @id @default(autoincrement())
  summary     Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id  Int
  material    Material @relation(fields: [material_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  material_id Int

  @@map("specifications")
}

// Потребленные материалы
model ConsumedMaterial {
  id          Int      @id @default(autoincrement())
  summary     Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id  Int
  material    Material @relation(fields: [material_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  material_id Int
  lot         Lot      @relation(fields: [lot_id], references: [id], onDelete: NoAction, onUpdate: Cascade)
  lot_id      Int
  employee    Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id Int
  createdAt   DateTime @default(now())

  @@map("consumed_materials")
}

// Примечания
model Note {
  id         Int     @id @default(autoincrement())
  summary    Summary @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id Int
  post_id    Int
  note       String

  @@map("notes")
}

// Параметры экструзии
model ExtrusionParam {
  id                                 Int      @id @default(autoincrement())
  summary                            Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id                         Int
  counter_value                      Int
  press_speed                        Int
  blow_time                          Int
  turning_machine_speed              Int
  annealing_furnace_temp             Int
  rondel                             Rondel   @relation(fields: [rondel_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  rondel_id                          Int
  tube_cilindrical_section_length    Int
  membrane_thickness                 Float
  tube_diameter                      Float
  tube_cilindrical_section_thickness Float
  tube_rigidity                      Int
  tube_cutting_quality               Boolean  @default(false)
  tightness                          Boolean  @default(false)
  external_thread_quality            Boolean  @default(false)
  employee                           Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id                        Int
  createdAt                          DateTime @default(now())

  @@map("extrusion_params")
}

// Границы экструзии
model ExtrusionTreshold {
  id                                     Int      @id @default(autoincrement())
  product                                Product  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id                             Int
  conveyor                               Conveyor @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id                            Int
  press_speed_min                        Int
  press_speed_max                        Int
  blow_time_min                          Int
  blow_time_max                          Int
  turning_machine_speed_min              Int
  turning_machine_speed_max              Int
  annealing_furnace_temp_min             Int
  annealing_furnace_temp_max             Int
  rondel                                 Rondel   @relation(fields: [rondel_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  rondel_id                              Int
  tube_cilindrical_section_length_min    Int
  tube_cilindrical_section_length_max    Int
  membrane_thickness_min                 Float
  membrane_thickness_max                 Float
  tube_diameter_min                      Float
  tube_diameter_max                      Float
  tube_cilindrical_section_thickness_min Float
  tube_cilindrical_section_thickness_max Float
  tube_rigidity_min                      Int
  tube_rigidity_max                      Int
  external_thread_value                  String
  createdAt                              DateTime @default(now())

  @@map("extrusion_tresholds")
}

//varnish
model VarnishParam {
  id                            Int      @id @default(autoincrement())
  summary                       Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id                    Int
  counter_value                 Int
  varnish_machine_speed         Int
  total_air_pressure            Float
  feed_can_air_pressure         Float
  nozzle_regulator_air_pressure Float
  cells_speed                   Int
  injection_a_start_position    Int
  injection_b_start_position    Int
  injection_c_start_position    Int
  injection_d_start_position    Int
  injection_a_end_position      Int
  injection_b_end_position      Int
  injection_c_end_position      Int
  injection_d_end_position      Int
  tube_molding_start_position   Int
  tube_molding_end_position     Int
  polimerization_furnace_temp   Int
  internal_varnish_porosity     Float
  internal_sectional_view       Boolean
  aluminium_clearance_lack      Boolean
  unpainting_lack               Boolean
  employee                      Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id                   Int
  createdAt                     DateTime @default(now())

  @@map("varnish_params")
}

model VarnishTreshold {
  id                                Int      @id @default(autoincrement())
  product                           Product  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id                        Int
  conveyor                          Conveyor @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id                       Int
  varnish_machine_speed_min         Int
  varnish_machine_speed_max         Int
  total_air_pressure_min            Float
  total_air_pressure_max            Float
  feed_can_air_pressure_min         Float
  feed_can_air_pressure_max         Float
  nozzle_regulator_air_pressure_min Float
  nozzle_regulator_air_pressure_max Float
  cells_speed_min                   Int
  cells_speed_max                   Int
  injection_a_start_position_min    Int
  injection_a_start_position_max    Int
  injection_b_start_position_min    Int
  injection_b_start_position_max    Int
  injection_c_start_position_min    Int
  injection_c_start_position_max    Int
  injection_d_start_position_min    Int
  injection_d_start_position_max    Int
  injection_a_end_position_min      Int
  injection_a_end_position_max      Int
  injection_b_end_position_min      Int
  injection_b_end_position_max      Int
  injection_c_end_position_min      Int
  injection_c_end_position_max      Int
  injection_d_end_position_min      Int
  injection_d_end_position_max      Int
  tube_molding_start_position_min   Int
  tube_molding_start_position_max   Int
  tube_molding_end_position_min     Int
  tube_molding_end_position_max     Int
  polimerization_furnace_temp_min   Int
  polimerization_furnace_temp_max   Int
  internal_varnish_porosity_min     Float
  internal_varnish_porosity_max     Float
  createdAt                         DateTime @default(now())

  @@map("varnish_tresholds")
}

//offset
model OffsetParam {
  id                             Int      @id @default(autoincrement())
  summary                        Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id                     Int
  counter_value                  Int
  printing_machine_speed         Int
  total_air_pressure             Int
  padding_furnace_temp           Int
  offset_furnace_temp            Int
  printer_motor                  Int
  base_covers_holders_motor      Int
  base_covers_station_motor      Int
  imprint_quantity_printed_box_1 Int?
  imprint_quantity_printed_box_2 Int?
  imprint_quantity_printed_box_3 Int?
  imprint_quantity_printed_box_4 Int?
  imprint_quantity_printed_box_5 Int?
  imprint_quantity_printed_box_6 Int?
  ink_supply_time                Float
  design_match                   Boolean  @default(false)
  tube_apperarance               Boolean  @default(false)
  tube_edge_deformation_lack     Boolean  @default(false)
  aluminium_clearance_lack       Boolean  @default(false)
  drips_lack                     Boolean  @default(false)
  employee                       Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id                    Int
  createdAt                      DateTime @default(now())

  @@map("offset_params")
}

model OffsetTreshold {
  id                                 Int      @id @default(autoincrement())
  product                            Product  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id                         Int
  conveyor                           Conveyor @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id                        Int
  printing_machine_speed_min         Int
  printing_machine_speed_max         Int
  total_air_pressure_min             Int
  total_air_pressure_max             Int
  padding_furnace_temp_min           Int
  padding_furnace_temp_max           Int
  offset_furnace_temp_min            Int
  offset_furnace_temp_max            Int
  printer_motor_min                  Int
  printer_motor_max                  Int
  base_covers_holders_motor_min      Int
  base_covers_holders_motor_max      Int
  base_covers_station_motor_min      Int
  base_covers_station_motor_max      Int
  imprint_quantity_printed_box_1_min Int?
  imprint_quantity_printed_box_1_max Int?
  imprint_quantity_printed_box_2_min Int?
  imprint_quantity_printed_box_2_max Int?
  imprint_quantity_printed_box_3_min Int?
  imprint_quantity_printed_box_3_max Int?
  imprint_quantity_printed_box_4_min Int?
  imprint_quantity_printed_box_4_max Int?
  imprint_quantity_printed_box_5_min Int?
  imprint_quantity_printed_box_5_max Int?
  imprint_quantity_printed_box_6_min Int?
  imprint_quantity_printed_box_6_max Int?
  ink_supply_time_min                Float
  ink_supply_time_max                Float
  createdAt                          DateTime @default(now())

  @@map("offset_tresholds")
}

//sealant

model SealantParam {
  id                               Int      @id @default(autoincrement())
  summary                          Summary  @relation(fields: [summary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  summary_id                       Int
  counter_value                    Int
  cap_machine_speed                Int
  total_air_pressure               Float
  holders_forward                  Int
  holders_opening_left             Int
  holders_opening_right            Int
  holders_closing                  Int
  injection_a_start                Int
  injection_b_start                Int
  injection_a_end                  Int
  injection_b_end                  Int
  injection_tube_orientation_start Int
  injection_tube_orientation_end   Int
  is_cap_surface_smooth            Boolean
  latex_ring_padding               Int
  latex_ring_width                 Int
  tube_rigidity                    Int
  cap_unscrewing_torque            Int
  employee                         Employee @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id                      Int
  createdAt                        DateTime @default(now())

  @@map("sealant_params")
}

model SealantTreshold {
  id                                   Int      @id @default(autoincrement())
  product                              Product  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  product_id                           Int
  conveyor                             Conveyor @relation(fields: [conveyor_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  conveyor_id                          Int
  cap_machine_speed_min                Int
  cap_machine_speed_max                Int
  total_air_pressure_min               Float
  total_air_pressure_max               Float
  holders_forward_min                  Int
  holders_forward_max                  Int
  holders_opening_left_min             Int
  holders_opening_left_max             Int
  holders_opening_right_min            Int
  holders_opening_right_max            Int
  holders_closing_min                  Int
  holders_closing_max                  Int
  injection_a_start_min                Int
  injection_a_start_max                Int
  injection_b_start_min                Int
  injection_b_start_max                Int
  injection_a_end_min                  Int
  injection_a_end_max                  Int
  injection_b_end_min                  Int
  injection_b_end_max                  Int
  injection_tube_orientation_start_min Int
  injection_tube_orientation_start_max Int
  injection_tube_orientation_end_min   Int
  injection_tube_orientation_end_max   Int
  latex_ring_padding_min               Int
  latex_ring_padding_max               Int
  latex_ring_width_min                 Int
  latex_ring_width_max                 Int
  tube_rigidity_min                    Int
  tube_rigidity_max                    Int
  cap_unscrewing_torque_min            Int
  cap_unscrewing_torque_max            Int
  createdAt                            DateTime @default(now())

  @@map("sealant_tresholds")
}

model ExtrusionOperation {
  id                   Int                    @id @default(autoincrement())
  value                String
  min_rank             Int                    @default(1)
  description          String
  statuses             ExtrusionStatus[]
  extrusionSopPictures ExtrusionSopPictures[]

  @@map("extrusion_operations")
}

model ExtrusionStatus {
  id            Int                 @id @default(autoincrement())
  summary       Summary             @relation(fields: [summary_id], references: [id], onUpdate: Cascade)
  summary_id    Int
  counter_value Int
  operation     ExtrusionOperation? @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id  Int?
  idle          Boolean             @default(false)
  employee      Employee?           @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id   Int?
  idle_time     Int?
  finished      Boolean             @default(false)
  createdAt     DateTime            @default(now())

  @@map("extrusion_statuses")
}

model VarnishOperation {
  id                 Int                  @id @default(autoincrement())
  value              String
  min_rank           Int                  @default(1)
  description        String
  statuses           VarnishStatus[]
  varnishSopPictures VarnishSopPictures[]

  @@map("varnish_operations")
}

model VarnishStatus {
  id            Int               @id @default(autoincrement())
  summary       Summary           @relation(fields: [summary_id], references: [id], onUpdate: Cascade)
  summary_id    Int
  counter_value Int
  operation     VarnishOperation? @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id  Int?
  idle          Boolean           @default(false)
  employee      Employee?         @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id   Int?
  idle_time     Int?
  finished      Boolean           @default(false)
  createdAt     DateTime          @default(now())

  @@map("varnish_statuses")
}

model OffsetOperation {
  id                Int                 @id @default(autoincrement())
  value             String
  min_rank          Int                 @default(1)
  description       String
  statuses          OffsetStatus[]
  offsetSopPictures OffsetSopPictures[]

  @@map("offset_operations")
}

model OffsetStatus {
  id            Int              @id @default(autoincrement())
  summary       Summary          @relation(fields: [summary_id], references: [id], onUpdate: Cascade)
  summary_id    Int
  counter_value Int
  operation     OffsetOperation? @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id  Int?
  idle          Boolean          @default(false)
  employee      Employee?        @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id   Int?
  idle_time     Int?
  finished      Boolean          @default(false)
  createdAt     DateTime         @default(now())

  @@map("offset_statuses")
}

model SealantOperation {
  id                 Int                  @id @default(autoincrement())
  value              String
  min_rank           Int                  @default(1)
  description        String
  statuses           SealantStatus[]
  sealantSopPictures SealantSopPictures[]

  @@map("sealant_operations")
}

model SealantStatus {
  id            Int               @id @default(autoincrement())
  summary       Summary           @relation(fields: [summary_id], references: [id], onUpdate: Cascade)
  summary_id    Int
  counter_value Int
  operation     SealantOperation? @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  operation_id  Int?
  idle          Boolean           @default(false)
  employee      Employee?         @relation(fields: [employee_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee_id   Int?
  idle_time     Int?
  finished      Boolean           @default(false)
  createdAt     DateTime          @default(now())

  @@map("sealant_statuses")
}
